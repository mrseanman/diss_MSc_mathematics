% !TeX root = ../../main.tex
\documentclass[class=article, crop=false]{standalone}
\begin{document}

\section{The subcomplex \texorpdfstring{$K^\prime_W$}{K prime}}
\label{sec:subcomplex_K_prime}

We now introduce the particular poset map we will use. Recall that $w$ is a choice of Coxeter element. Given the standard ordering of $\N$, the map $\eta \colon \mathcal{F}(K_W) \to \N$ with
\begin{equation}
    \eta([x_1|x_2|\cdots|x_d]) \coloneq \begin{cases}
        d   &\text{if } x_1x_2\ldots x_d = w\\
        d+1 &\text{otherwise }
    \end{cases}
    \label{eqn:mu_poset_map}
\end{equation}
is a poset map. This can be readily checked. We call a connected component of $\eta^{-1}(d)$ a \emph{$d$--fibre component}. We now investigate the form of these $d$--fibre components.

Consider such a $d$--fibre component $f$ such that $\sigma \coloneq [x_1|x_2|\cdots|x_d] \in f$. We must have $x_1x_2\ldots x_d = w$ and so if $\sigma \lessdot \tau$ for some $\tau$, then $\tau$ would be in $\eta^{-1}(d+1)$, not in $f$. The faces of $\sigma$ are $[x_2|\cdots|x_d]$, $[x_1|\cdots|x_{d-1}]$ and $[x_1|\cdots|x_ix_{i+1}|\cdots|x_d]$ for all $i<d$. Only the first two of these faces will be in $f$ since $\eta([x_1|\cdots|x_ix_{i+1}|\cdots|x_d]) = d-1$. Therefore, a $d$--fibre component will look like \cref{fig:fibre_component_eg}. We say that $[x_1 |\cdots|x_d]$ satisfying the first case of \eqref{eqn:mu_poset_map} such that $x_1x_2\cdots x_d = w$ are in the \emph{top row} of their fibre component. The cells satisfying the second case of \eqref{eqn:mu_poset_map} are in the \emph{bottom row} of their fibre component.

\begin{figure}
\centering
\begin{tikzpicture}[scale=1.2, baseline=0.5cm]
    \tikzstyle{every label}=[font=\scriptsize]
    \tikzstyle{every node}=[font=\footnotesize]
    \node[FSC] (a1) at (0,0)            [label=below:{$[x_0|\cdots|x_{d-2}]$}]      {};
    \node[FSC] (a2) at (1,0.8666)       [label=above:{$[x_0|\cdots|x_{d-1}]$}]      {};
    \node[FSC] (a3) at (2,0)            [label=below:{$[x_1|\cdots|x_{d-1}]$}]      {};
    \node[FSC] (a4) at (3,0.8666)       [label=above:{$[x_1|\cdots|x_{d}]$}]        {};
    \node[FSC] (a5) at (4,0)            [label=below:{$[x_2|\cdots|x_{d}]$}]        {};
    \node[FSC] (a6) at (5,0.8666)       [label=above:{$[x_2|\cdots|x_{d+1}]$}]      {};
    \node[FSC] (a7) at (6,0)            [label=below:{$[x_3|\cdots|x_{d+1}]$}]      {};

    \node (fake_l) at (-1,0.8666) {};
    \node (fake_r) at (7,0.8666) {};

    \draw (a1) to (a2) to (a3) to (a4) to (a5) to (a6) to (a7);
    \draw[thick, dotted] (a1) to (fake_l);
    \draw[thick, dotted] (a7) to (fake_r);
\end{tikzpicture}
\caption{The general form of a connected $d$--fibre component.}
\label{fig:fibre_component_eg}
\end{figure}


To each fibre component there is an associated sequence $(x_i)_{i \in \Z}$ such that every product of $d$ consecutive elements is equal to $w$ and each corresponding cell from the sequence is in $K_W$. Denote the set of all such sequences $S_d$. For each fibre component, the choice of $s \in S_d$ is unique up translation of indices.

\begin{remark}
    Consider some cell $[x_1|\cdots|x_{d-1}]$, i.e.~a cell in the bottom row of \cref{fig:fibre_component_eg}. To form the whole fibre component, you may choose to move up and to the right along the Hasse diagram from to $[x_1|\cdots|x_{d}]$. This is always possible and completely deterministic, since $x_1x_2\ldots x_{d-1}$ is a prefix of a minimal factorisation of $w$ and the product $x_1x_2\ldots x_d$ must equal $w$. Similarly, a movement up and leftward is always possible and deterministic using the balanced property of $[1,w]^W$. Thus, a fibre component does not have initial of final nodes and its Hasse diagram will either be homeomorphic to $\R$ or $S^1$.
    A finite fibre component will have a repeating sequence. If the sequence repeats every $n$, then the Hasse diagram of the fibre component will contain $2n$ nodes. An infinite fibre component will be non--repeating, though an individual group element $x_i$ may be repeated in the sequence.
    \label{rmk:finite_sequence_repetition}
\end{remark}

The previous remark shows that each sequence $s \in S_d$ is uniquely determined by any length $(d-1)$ subsequence. Furthermore, by the following remark, once we have fixed any length $d$ subsequence we have an explicit formula for translating this subsequence to generate the whole sequence.
\begin{remark}
    Let $\phi$ denote conjugation by $w$, i.e.~$\phi(x) = w^{-1}xw$. Then we have $\phi(x_i) = x_{i+d}$ and $\phi^{-1}(x_i) = x_{i-d}$ by the following factorisation.
\begin{equation*}
    \phi(x_i) = (x_{i+d-1}^{-1}x_{i+d-2}^{-1}\ldots x_i^{-1})x_i(x_{i+1}x_{i+2}\ldots x_{i+d})
\end{equation*}
\end{remark}

We will now define a subcomplex $K^\prime_W \subseteq K_W$ based on these fibre components. Denote the power set of $\mathcal{F}(K_W)$ by $\mathcal{P}({\mathcal{F}(K)})$. Let $F\subseteq \mathcal{P}({\mathcal{F}(K)})$ be the set of all connected fibre components such that $\bigcup_{f \in F}f = \mathcal{F}(K_W)$. Recall  $X^\prime_W$ from \cref{def:subcomplex_X_prime}.

\begin{definition}[The subcomplex $K^\prime_W$]
    For each infinite $f \in F$ let $f^\prime$ be the elements of $f$ in between and including the first and last elements of $f \cap X_W^\prime$, where \emph{first}, \emph{last} and \emph{in between} derive from the linear form of the fibre components as in \eqref{fig:fibre_component_eg}. Define $K^\prime_W$ to be the union of all finite $f$ and $f^\prime$ such that $f$ is infinite. 
    \label{def:subcomplex_K_prime}
\end{definition}

For $K^\prime$ to be well--defined, we require that the construction of each $f^\prime$ be well--defined. This requires that $f \cap X^\prime_W \neq \emptyset$ for each infinite $f$. This happens to be a detail for which the proof relies on $W$ being of affine type.

\begin{lemma}[{\hspace{1sp}\cite[Lemma 7.6]{paolini_salvetti_kpi1_2021}}]
    \label{lem:intersection_fibre_components_X_prime}
    Given a Coxeter group $W$ of affine type and $f\in F$ a $d$--fibre component, there exists a simplex $\tau = [x_1|x_2|\cdots|x_{d-1}] \in f$ such that $\tau$ is also in $X_W^\prime$. 
\end{lemma}

Note that for finite $f$, the Hasse diagram of $f$ is homeomorphic to $S^1$. So, for finite $f$ there is no notion of \emph{in between}. Recall that $X^\prime_W$ is finite, so $f \cap X^\prime_W$ is finite and \emph{first} and \emph{last} are well--defined.

The next property of $K^\prime_W$ we must prove is that $K^\prime_W$ is indeed a valid subcomplex of $K_W$, satisfying \eqref{eqn:valid_subcomplex_requirement}.

\begin{lemma}
    As defined above, $K^\prime_W$ is a valid subcomplex of $K_W$.
    \label{lem:K_prime_valid_subcomplex}   
\end{lemma}
\begin{proof}
    We first concentrate on the infinite $f \in \eta^{-1}(d)$. We need to show that for any infinite $f \in F$, if $\tau \in f^\prime$ and $\sigma \lessdot \tau$, then there exists some $g \in F$ such that $\sigma \in g^\prime$. Let $s = (x_n)_{n \in \Z}$ be the sequence of group elements corresponding to $f$ such that $x_0$ is the first group element in the symbol for $\tau$ (i.e.~$\tau$ begins with $[x_0| \, \cdots$). Let $\tau$ be between $\alpha$ and $\omega$, both in $f \cap X^\prime_W$. See \cref{fig:acyclic_matching_fibre_components}. All of $[-\infty, \alpha]$ and $[-\infty, \omega]$ are also in $X^\prime_W$, so we may assume that both $\alpha$ and $\omega$ are in the bottom row of the Hasse diagram of $f^\prime$ and accordingly each consist of $d-1$ group elements. Choose $a,z \in \Z$ such that $\alpha = [x_a | \cdots | x_{a+d-2}]$ and $\omega = [x_z|\cdots|x_{z+d-2}]$.
    
    $\bullet$ First we will prove the case where $\tau$ is in the top row of $f^\prime$ such that $\tau = [x_0|x_1|\cdots | x_{d-1}]$ with $x_0x_1\cdots x_{d-1} = w$. The two faces $[x_1|\cdots|x_{d-1}]$ and $[x_0|\cdots|x_{d-2}]$ are both already in $f^\prime$, so we need only check the faces
    \begin{equation*}
        \sigma^i = [x_0|\cdots|x_ix_{i+1}|\cdots|x_{d-1}] \lessdot \tau.
    \end{equation*}
    Each of the $\sigma^i$  are in $\eta^{-1}(d-1)$. Given the sequence $s = (x_n)_{n \in \Z}$, we define the following.
    \begin{equation*}
        s^i \coloneq (y^i_n)_{n \in \Z} = (\ldots, x_0, x_1, \ldots, x_ix_{i+1}, \ldots x_{d}, \ldots, x_{d+i}x_{d+i+1}, \ldots, x_{2d}, \ldots)
    \end{equation*}
    Where we multiply each adjacent pair $x_j,x_{j+1}$ by removing the comma wherever $j \equiv i \mod d$. We see that every product of $(d-1)$ consecutive terms in $s^i$ is $w$. Each $s^i$ is the sequence corresponding to some connected component of $\eta^{-1}(d-1)$. Each face $\sigma^i \lessdot \tau$ is in the connected component associated to $s^i$. Denote this component $g^i$. We need to show that there exists $\alpha^\prime, \omega^\prime \in g^i$ such that $\alpha^\prime \leq \alpha$ and $\omega^\prime \leq \omega$ and thus that $\alpha^\prime, \omega^\prime \in X^\prime_W$. We may choose $\alpha^\prime$ and $\omega^\prime$ to be any $[y^i_k|\cdots|y^i_{k+d-3}]$, i.e.~a cell on the bottom row of $g^i$ consisting of $(d-2)$ group elements. Let us concentrate on $\alpha^\prime$. There are three possibilities. Recall that $\alpha = [x_a | \cdots | x_{a+d-2}]$ and $\omega = [x_z|\cdots|x_{z+d-2}]$.
    \begin{enumerate}
        \item $a-i \equiv 1 \mod d$ in which case the relevant part of $s^i$ looks like
        \begin{equation*}
            \ldots, x_{a-2}, x_{a-1}x_a, x_{a+1}, \ldots, x_{a+d-2}, x_{a+d-1}x_{a+d}, x_{a+d+1}, \ldots.
        \end{equation*}
        We choose $\alpha^\prime = [x_{a+1}|\cdots|x_{a+d-2}]$.
        \item $a-i \equiv 2 \mod d$ in which case the relevant part of $s^i$ looks like
        \begin{equation*}
            \ldots, x_{a-3}, x_{a-2}x_{a-1}, x_{a}, \ldots, x_{a+d-3}, x_{a+d-2}x_{a+d-1}, x_{a+d}, \ldots.
        \end{equation*}
        We choose $\alpha^\prime = [x_{a}|\cdots|x_{a+d-3}]$.
        \item $a-i \equiv k \mod d$ with $3\leq k\leq d$ in which case the relevant part of $s^i$ looks like
        \begin{equation*}
            \ldots, x_{a}, x_{a+1}, \ldots, x_{a+i}x_{a+i+1}, \ldots, x_{a+d-1}, x_{a+d}, \ldots.
        \end{equation*}
        We choose $\alpha^\prime = [x_a|\cdots|x_{a+i}x_{a+i+1}|\cdots|x_{a+d-2}]$.
    \end{enumerate}
    In all cases $\alpha^\prime$ is a cell in the bottom row of $g^\prime$ and in $[-\infty,\alpha]$. The same argument works for $\omega$ as well. We see that $\sigma$ is indeed between two cells in $X^\prime_W$ within some fibre component.

    $\bullet$ Now we consider the case where $\tau = [x_0|\cdots|x_{d-2}]$ is in the bottom row of $f^\prime$. We can use the same methods as before. The two additional faces $[x_1|\cdots|x_{d-2}]$ and $[x_0|\cdots|x_{d-3}]$ to consider do not pose any extra difficulty. We can choose an appropriate $s^i$ and proceed as before.

    We now focus on the case where $\tau \in f$ and $f$ is finite. By \cref{rmk:finite_sequence_repetition} the sequence $s$ associated to $f$ will be repeating. We can again case--split whether $\tau$ is in the top or bottom row of the Hasse diagram for $f$. In either case, a face $\sigma \lessdot \tau$ will be in a component $g \in F$ associated to an appropriately chosen $s^i$. This $s^i$ will also be repeating, thus the associated $g$ will be finite.
\end{proof}

\begin{remark}
    Given some non--repeating sequence $s \in S_d$, repeated application of the map $s \mapsto s^i$ (for valid choices of $i$ each time) must eventually result in a repeating sequence.
\end{remark}

We now get to reap the benefits of working in this strange setting of face posets.

\tikzmath{
	\hsep = 0.5;
	\vsep = 0.9;
}
\tikzstyle{m}=[green!70!black, arrow_me=stealth]
\tikzstyle{not_m}=[arrow_me=stealth]
\tikzstyle{FSC_highlight}=[circle, draw=black!50,fill=red!40,thick, inner sep=0pt,minimum size=1.5mm]
\begin{figure}[ht]
    \centering
    \begin{tikzpicture}[scale=1.2, baseline=0.5cm]
        \tikzstyle{every label}=[font=\footnotesize]
        \tikzstyle{every node}=[font=\footnotesize]

        \node       (a1) at (0,0)                           {};
        \node[FSC]  (a2) at ($(a1) + (\hsep, \vsep)$)       {};
        \node[FSC]  (a3) at ($(a2) + (\hsep, -\vsep)$)      {};
        \node[FSC]  (a4) at ($(a3) + (\hsep, \vsep)$)       {};
        \node[FSC]  (a5) at ($(a4) + (\hsep, -\vsep)$)      {};
        \node[FSC]  (a6) at ($(a5) + (\hsep, \vsep)$)       {};
        \node[FSC_highlight]  (a7) at ($(a6) + (\hsep, -\vsep)$)    [label=below:{$\smallvertin{\alpha}{X^\prime_W}$}]  {};
        \node[FSC_highlight]  (a8) at ($(a7) + (\hsep, \vsep)$)       {};
        \node[FSC_highlight]  (a9) at ($(a8) + (\hsep, -\vsep)$)      {};
        \node       (a10) at ($(a9) + (\hsep, \vsep)$) {};

        \node (b0)  at ($(a10) + (1.1,0)$) {};
        \node[FSC_highlight]  (b1) at ($(b0) + (\hsep,-\vsep)$)                {};
        \node[FSC_highlight]  (b2) at ($(b1) + (\hsep, \vsep)$)       {};
        \node[FSC_highlight]  (b3) at ($(b2) + (\hsep, -\vsep)$)   [label=below:{$\smallvertin{\omega}{X^\prime_W}$}]   {};
        \node[FSC]  (b4) at ($(b3) + (\hsep, \vsep)$)       {};
        \node[FSC]  (b5) at ($(b4) + (\hsep, -\vsep)$)      {};
        \node[FSC]  (b6) at ($(b5) + (\hsep, \vsep)$)       {};
        \node[FSC]  (b7) at ($(b6) + (\hsep, -\vsep)$)      {};
        \node[FSC]  (b8) at ($(b7) + (\hsep, \vsep)$)       {};
        \node       (b9) at ($(b8) + (\hsep, -\vsep)$)      {};

        % see https://tex.stackexchange.com/questions/646915/how-add-1-in-math-expression-inside-tikz-foreach-loop
        \foreach \x in {3,5}
        \draw[m] (a\x) to (a\the\numexpr \x + 1\relax);

        \foreach \x in {3,5,7,9}
        \draw[not_m] (a\the\numexpr \x -1\relax) to (a\x);

        \foreach \x in {8}
        \draw[not_m] (a\x) to (a\the\numexpr \x -1\relax);


        \foreach \x in {5,7}
        \draw[m] (b\x) to (b\the\numexpr \x - 1\relax);

        \foreach \x in {1,3,5,7}
        \draw[not_m] (b\the\numexpr \x +1\relax) to (b\x);

        \foreach \x in {2}
        \draw[not_m] (b\x) to (b\the\numexpr \x +1\relax);

        \draw[dotted, thick, green!70!black] (a2) to (a1);
        \draw[dotted, thick, green!70!black] (b8) to (b9);
        \draw[dotted, thick] (a9) to (a10);
        \draw[dotted, thick] (b0) to (b1);

        \draw [decorate,
			decoration = {calligraphic brace, raise=4pt, amplitude=10pt}]
	($(a7) + (-0.1, 0.2 + \vsep)$) --  ($ (b3) + (0.1,0.2+\vsep)$)
	node[pos=0.5, above=15pt]{$f^\prime$};
    \end{tikzpicture}
    \caption{The unique acyclic matching $\mathcal{M}_{f}$ on $f$ such that the critical cells correspond to exactly $f^\prime$. Here $\alpha$ and $\omega$ are the relevant first and last elements in $f \cap X^\prime_W$ as in the proof of \cref{lem:K_prime_valid_subcomplex}. Critical cells are red and edges in $\mathcal{M}_f$ are green.}
    \label{fig:acyclic_matching_fibre_components}
\end{figure}

\begin{theorem}[{\hspace{1sp}\cite[Theorem 7.9, Lemma 7.11]{paolini_salvetti_kpi1_2021}}]
    The subcomplex $K_W^\prime$ is a deformation retract of $K_W$.
    \label{thm:subcomplex_K_prime_hom_equiv_K}
\end{theorem}
\begin{proof}
We will utilise the patchwork theorem (\cref{thm:patchwork_theorem}). We need to show that for each $f \in F$, we have an acyclic matching $\mathcal{M}_f$ such that the critical vertices corresponding to $\mathcal{M}_f$ are exactly those contained in $K_W^\prime$. For finite $f$, this is trivial. We choose $\mathcal{M}_f = \emptyset$. For infinite $f$, choosing such an $\mathcal{M}_f$ is very simple, as shown in \cref{fig:acyclic_matching_fibre_components}. This choice of $\mathcal{M}_f$ is unique. The union of these $\mathcal{M}_f$ is an acyclic matching on $\mathcal{F}(K_W)$ by \cref{thm:patchwork_theorem}. Denote this matching $\mathcal{M}$. Denote the directed graph resulting from orientation of edges in the Hasse diagram of $\mathcal{F}(K_W)$ by this matching as $H_\mathcal{M}$. We have that $\mathcal{M}$ is also proper since any directed path in $H_\mathcal{M}$ can only travel inwards along fibre components, eventually reaching some element in $\mathcal{F}(K^\prime_W)$. After reaching an element of $\mathcal{F}(K^\prime_W)$, the path can only travel downwards. Since $\mathcal{F}(K_W)$ is finite--height, this path must eventually terminate. So by $\mathcal{M}$ is an acyclic, proper matching. By \cref{thm:dmt}, this gives a deformation retract on to the union of the critical cells of $\mathcal{M}$, which is exactly $K_W^\prime$.
\end{proof}
\end{document}